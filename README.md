# ZatBlagGit

Program for updating fields in a SQL database

Dokumentacija programa ZatBlag

Program â€œZatBlagâ€ je napravljen sa svrhom da se resi problem kada ne mogu da se zatvore blagajne iz BBIS-a I moraju da se â€œzatvore iz bazeâ€. Ovaj program treba da omoguci svim korisnicima to da urade bez pristupa serveru I znanja SQL-a. Program je napravljen koriscenjem XAML I C# . Pri pokretanju programa mozemo da vidimo sledece:

Pocetni user interface sadrzi:

Naslov
Polje za unos broja poslovnice
DatePicker za unos\odabir datuma
Polje za unos broja blagajne
Label statusa/obavestenja (default: â€œProveri da li su zatvorene blagajneâ€)
DataGrid gde se prikazuju podaci iz baze
Dugme â€œProveraâ€ Polja za unos broja poslovnice I broja blagajne sadrze â€œInput Validationâ€ koji ogranicava da mogu samo da se unose brojevi (0-9) u ta polja. Polje za unos broja poslovnice dalje ogranicava unos do 6 brojeva, dok polje za unos blagajne ogranicava na 4 broja.
Pritiskom na dugme â€œProveraâ€ pokrece se:

Provera da li je ispravno unet broj poslovnice. Uneseni podaci se proveravaju u odnosu na regex formu â€œ2\d\d\d00â€ (da pocniju sa â€œ2â€ pa idu 3 cifre I zavrsava se sa â€œ00â€). Ako nije ispunjen ovaj uslov izlazi poruka â€œPogresno unet broj poslovniceâ€ I focus se stavlja na polje za unos broja poslovnice. Ako je uslov ispunjen program nastavlja dalje.
Porvera da li je izabrani datum NULL (nije izabran) ili da li je izabrani datum >= danasnjeg datuma. Ako je bilo sta od ta dva, izlazi poruka â€œMorate da izaberete datum I da bude pre danasnjeg datumaâ€ I focus se stavlja na DatePicker. Ako nije jedna od ove dve situacije program nastavlja dalje.
Provera da li je datum vise od 7 dana unazad ( tacan kod glasi: SelectedDate < now.AddDays(-8) ). Ako je izabran datum vise od 7 dana unazad, izlazi poruka â€œIzabrani datum ne sme da bude stariji od 7 danaâ€ I focus se stavlja na DatePicker. Ukoliko je uslov kako treba program nastavlja dalje.
Provera da li je ispravno unet broj blagajne. Prvo proveravamo opet da li je dobar unos broja poslovnice. Ako nije izlazi poruka â€œPoslovnica nije dobro unetaâ€. Ako jeste, od broja poslovnice uzimamo 3 identifikaciona broja poslovnice. Proveravamo da li je unesen prazan string u polje broja blagajne. Ako nije proveravamo da li uneseni podaci odgovaraju regex formi â€œ[1-9]\d\d\dâ€ (prvi broj da bude od 1 do 9 I onda 3 cifre) I da li poslednja 3 broja blagajne su ista kao I 3 identifikaciona broja poslovnice. Ako ovi uslovi nisu ispunjeni izlazi poruka â€œBlagajna nije uneta kako trebaâ€ I focus se stavlja na polje za unos blagajne. Ako je sve kako treba program nastavlja dalje
Da bi program nastavio mora opet da ispuni uslove: a. Tacno unet broj poslovnice (tacka 1) b. Izabrani datum nije NULL c. Izabrani datum je pre danasnjeg d. Izabrani datum nije pre vise od 7 dana (u kodu 8 da bi obuhvatio I sedmi dan) e. Tacno unet broj blagajne (tacka 4) Ako su svi uslovi ispunjeni program nastavlja dalje
Proveravamo da li se ping-uje adresa â€œ192.168.1.46â€. Ako ping-ovanje nije uspelo izlazi poruka â€œNe pingujem server 192.168.1.46â€. Ako je uspesno ping-ovan server, program nastavlja dalje
Provera da li uneta poslovnica postoji u bazi. Ako preko upita â€œselect POSL FROM BI_POSL WHERE POSL = {broj poslovnice} and AKTIVNA = 'D'â€ dobijemo podatak (razlicit od null) program smatra da poslovnica postoji u bazi I nastavlja dalje. Ukoliko uslov nije ispunjen izlazi poruka â€œPoslovnica ne postoji u baziâ€ I focus se stavlja na polje za unos broja poslovnice.
Provera da uneta blagajna postoji u bazi za unetu poslovnicu. Ako preko upita â€œselect BLAG_POSL from BI_BLAGPOSL where BLAG_POSL = {broj blagajne} and MATICNA_POSL = {broj poslovnice} and AKTIVNA = 'D'â€ dobijemo podatak (razlicit od null) program smatra da blagajna u toj poslovnici postoji u bazi I nastavlja dalje. Ukoliko uslov nije ispunjen izlazi poruka â€œBlagajna ne postoji u bazi ili u toj poslovniciâ€ I focus se stavlja na polje za unos blagajne.
Odabrani datum convertujemo u string u formatu â€œyyyyMMddâ€
Pokusavamo da dobijemo IP adresu kase. Za to koristimo upit â€œselect IP_LOKALNI_NASLOV, blag_posl from BI_BLAGPOSL where MATICNA_POSL = {Broj poslovnice} and blag_posl = {Broj Blagajne}â€. Ako ne uspemo da procitamo podatak iz baze izlazi poruka â€œNO DATA FOUNDâ€. Ako ne uspemo da dobijemo IP adresu blagajne, ista se postavlja na vrednost NULL.
Provera da li je IP adresa kase jednaka NULL. Ako jeste izlazi poruka â€œIP BLAG JE NULLâ€. Ako nije, program nastavlja dalje
Pokusavamo da ping-ujemo ip kase. Ukoliko ne uspemo, Izlazi poruka â€œNe pingujem kasu!â€ I Label statusa se menja na â€œNe pingujem kasu!â€ (font postaje bold, povecava se za 5px, I boji se u crvenu boju). Ako uspesno pingujemo kasu, program nastavlja dalje.
Provera da li su â€œOdhodiâ€ dobri. Uzimamo IP adresu kase I pravimo putanju \IPKASE\RCL\xmlblag\odhodi. Na toj putanji proveravamo koliko ima file-ova. Ako ima 3 ili vise file-ova Label statusa se menja da pise â€œOdhodi nisu prazni, resetuj sepisâ€ (font se boldira, povecava za 5px I boji u crveno). Ako imaju 2 ili manje program nastavlja dalje.
Label status se menja na â€œOdhodi su OK ğŸ˜Šâ€
DataGrid se popunjava podacima iz baze, dobijenim upitom â€œselect ODPRTA, TIP_ODPIS, BLAG_POSL, KODA from Bip_prom where KODA in ('BK','BZ') and POSL = {Broj Poslovnice} and DATUM = '{Datum}' order by BLAG_POSL DESCâ€
Provera da li je blagajna vec zatvorena. Pozivamo podatke iz baze uz upit â€œselect ODPRTA, TIP_ODPIS, BLAG_POSL from Bip_prom where KODA in ('BK','BZ') and POSL = {Broj Poslovnice} and DATUM = '{Datum}' order by BLAG_POSL DESCâ€. Provera se vrsi tako sto prolazimo kroz redove gde je BLAG_POSL jednak unetom broju blagajne, proveravamo da li je â€œODPRTAâ€ jednaka â€œâ€ I TIP_ODPISâ€ jednak â€œ4â€. Ako jesu izlazi poruka â€œBlagajna je vec zatvorenaâ€. Ako negde nije â€œODPRTAâ€ jednaka â€œâ€ I TIP_ODPISâ€ jednak â€œ4â€ program nastavlja dalje.
Property Visibility, na dugmetu â€œZatvoriâ€, se menja sa â€œHiddenâ€ na â€œVisibleâ€. Cime user interface dobija jos jedno dugme â€œZatvori !â€.
Ako dugme proveri dodje do tacke 17, program ce izgledati ovako:

Pritiskom na dugme â€œZatvori !â€ pokrece se (tacke 2-17 su iste kao prvih 16 za dugme â€œProveraâ€):

Izlazi prozor sa porukom â€œDa li ste sigurni da zelite da zatvorite blagajnu?â€. Dugmici na prozoru su â€œYesâ€, â€œNoâ€, â€œCancelâ€. Pritiskanjem na dugmice â€œNoâ€, â€œCancelâ€ ili izlazkom iz ovog prozora izlazi poruka â€œPrekinut process zatvaranja blagajneâ€ I property Visibility, na dugmetu â€œZatvoriâ€, se menja sa â€œVisibleâ€ na â€œHiddenâ€. Cime se user interface vraca na pocetno stanje. Ako se pritisne dugme â€œYesâ€ program nastavlja dalje.
Provera da li je ispravno unet broj poslovnice. Uneseni podaci se proveravaju u odnosu na regex formu â€œ2\d\d\d00â€ (da pocniju sa â€œ2â€ pa idu 3 cifre I zavrsava se sa â€œ00â€). Ako nije ispunjen ovaj uslov izlazi poruka â€œPogresno unet broj poslovniceâ€ I focus se stavlja na polje za unos broja poslovnice. Ako je uslov ispunjen program nastavlja dalje.
Porvera da li je izabrani datum NULL (nije izabran) ili da li je izabrani datum >= danasnjeg datuma. Ako je bilo sta od ta dva, izlazi poruka â€œMorate da izaberete datum I da bude pre danasnjeg datumaâ€ I focus se stavlja na DatePicker. Ako nije jedna od ove dve situacije program nastavlja dalje.
Provera da li je datum vise od 7 dana unazad ( tacan kod glasi: SelectedDate < now.AddDays(-8) ). Ako je izabran datum vise od 7 dana unazad, izlazi poruka â€œIzabrani datum ne sme da bude stariji od 7 danaâ€ I focus se stavlja na DatePicker. Ukoliko je uslov kako treba program nastavlja dalje.
Provera da li je ispravno unet broj blagajne. Prvo proveravamo opet da li je dobar unos broja poslovnice. Ako nije izlazi poruka â€œPoslovnica nije dobro unetaâ€. Ako jeste od broja poslovnice uzimamo 3 identifikaciona broja poslovnice. Proveravamo da li je unesen prazan string u polje broja blagajne. Ako nije proveravamo da li uneseni podaci odgovaraju regex formi â€œ[1-9]\d\d\dâ€ (prvi broj da bude od 1 do 9 I onda 3 cifre) I da li poslednja 3 broja blagajne su ista kao I 3 identifikaciona broja poslovnice. Ako ovi uslovi nisu ispunjeni izlazi poruka â€œBlagajna nije uneta kako trebaâ€ I focus se stavlja na polje za unos blagajne. Ako je sve kako treba program nastavlja dalje
Da bi program nastavio mora opet da ispuni uslove: a. Tacno unet broj poslovnice (tacka 1) b. Izabrani datum nije NULL c. Izabrani datum je pre danasnjeg d. Izabrani datum nije pre vise od 7 dana (u kodu 8 da bi obuhvatio I sedmi dan) e. Tacno unet broj blagajne (tacka 4) Ako su svi uslovi ispunjeni program nastavlja dalje
Proveravamo da li se ping-uje adresa â€œ192.168.1.46â€. Ako ping-ovanje nije uspelo izlazi poruka â€œNe pingujem server 192.168.1.46â€. Ako je uspesno ping-ovan server, program nastavlja dalje
Provera da li uneta poslovnica postoji u bazi. Ako preko upita â€œselect POSL FROM BI_POSL WHERE POSL = {broj poslovnice} and AKTIVNA = 'D'â€ dobijemo podatak (razlicit od null) program smatra da poslovnica postoji u bazi I nastavlja dalje. Ukoliko uslov nije ispunjen izlazi poruka â€œPoslovnica ne postoji u baziâ€ I focus se stavlja na polje za unos broja poslovnice.
Provera da uneta blagajna postoji u bazi za unetu poslovnicu. Ako preko upita â€œselect BLAG_POSL from BI_BLAGPOSL where BLAG_POSL = {broj blagajne} and MATICNA_POSL = {broj poslovnice} and AKTIVNA = 'D'â€ dobijemo podatak (razlicit od null) program smatra da blagajna u toj poslovnici postoji u bazi I nastavlja dalje. Ukoliko uslov nije ispunjen izlazi poruka â€œBlagajna ne postoji u bazi ili u toj poslovniciâ€ I focus se stavlja na polje za unos blagajne.
Odabrani datum convertujemo u string u formatu â€œyyyyMMddâ€
Pokusavamo da dobijemo IP adresu kase. Za to koristimo upit â€œselect IP_LOKALNI_NASLOV, blag_posl from BI_BLAGPOSL where MATICNA_POSL = {Broj Poslovnice} and blag_posl = {Broj Blagajne}â€. Ako ne uspemo da procitamo podatak iz baze izlazi poruka â€œNO DATA FOUNDâ€. Ako ne uspemo da dobijemo IP adresu blagajne, ista se postavlja na vrednost NULL.
Provera da li je IP adresa kase jednaka NULL. Ako jeste izlazi poruka â€œIP BLAG JE NULLâ€. Ako nije, program nastavlja dalje
Pokusavamo da ping-ujemo ip kase. Ukoliko ne uspemo, Izlazi poruka â€œNe pingujem kasu!â€ I Label statusa se menja na â€œNe pingujem kasu!â€ (font postaje bold, povecava se za 5px, I boji se u crvenu boju). Ako uspesno pingujemo kasu, program nastavlja dalje.
Provera da li su â€œOdhodiâ€ dobri. Uzimamo IP adresu kase I pravimo putanju \IPKASE\RCL\xmlblag\odhodi. Na toj putanji proveravamo koliko ima file-ova. Ako ima 3 ili vise file-ova Label statusa se menja da pise â€œOdhodi nisu prazni, resetuj sepisâ€ (font se boldira, povecava za 5px I boji u crveno). Ako imaju 2 ili manje program nastavlja dalje.
Label status se menja na â€œOdhodi su OK ğŸ˜Šâ€
DataGrid se popunjava podacima iz baze, dobijenim upitom â€œselect ODPRTA, TIP_ODPIS, BLAG_POSL, KODA from Bip_prom where KODA in ('BK','BZ') and POSL = {Broj Poslovnice} and DATUM = '{Datum}' order by BLAG_POSL DESCâ€
Provera da li je blagajna vec zatvorena. Pozivamo podatke iz baze uz upit â€œselect ODPRTA, TIP_ODPIS, BLAG_POSL from Bip_prom where KODA in ('BK','BZ') and POSL = {Broj Poslovnice} and DATUM = '{Datum}' order by BLAG_POSL DESCâ€. Provera se vrsi tako sto prolazimo kroz redove gde je BLAG_POSL jednak unetom broju blagajne, proveravamo da li je â€œODPRTAâ€ jednaka â€œâ€ I TIP_ODPISâ€ jednak â€œ4â€. Ako jesu izlazi poruka â€œBlagajna je vec zatvorenaâ€. Ako negde nije â€œODPRTAâ€ jednaka â€œâ€ I TIP_ODPISâ€ jednak â€œ4â€ program nastavlja dalje.
Pokrece se upit â€œupdate BIP_PROM set ODPRTA = '*', TIP_ODPIS = '4' where KODA in ('BK','BZ') and POSL = {Broj Poslovnice} and DATUM = '{Datum}' and BLAG_POSL = {Broj Blagajne}â€. Ovim upitom â€œzatvaramo blagajnuâ€. Takodje u ovom koraku ipisujemo poruku â€œPromenjeno je {Broj promena} redovaâ€ (odnoseci se na koji broj redova je promenjen u bazi)
Provera da li je blagajna zatvorena, uz pomoc upita â€œselect ODPRTA, TIP_ODPIS, BLAG_POSL from Bip_prom where KODA in ('BK','BZ') and POSL = {Broj Poslovnice} and DATUM = '{Datum}' order by BLAG_POSL DESCâ€. Ako je zatvorena ispisujemo poruku â€œZatvorena je blagajna {Broj Blagajne} u poslovnici {Broj Poslovnice} za datum {Datum}â€
DataGrid se popunjava podacima iz baze, dobijenim upitom â€œselect ODPRTA, TIP_ODPIS, BLAG_POSL, KODA from Bip_prom where KODA in ('BK','BZ') and POSL = {Broj Poslovnice} and DATUM = '{Datum}' order by BLAG_POSL DESCâ€
Label statusa menjamo na â€œBlagajna je zatvorenaâ€
Property Visibility, na dugmetu â€œZatvoriâ€, se menja sa â€œVisibleâ€ na â€œHiddenâ€. Cime se user interface vraca na pocetno stanje.
